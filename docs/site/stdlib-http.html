<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>http - Nex Docs</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
<header class="site-header">
  <button class="menu-toggle">&#9776;</button>
  <div class="logo">Nex <span>Documentation</span></div>
  <div class="header-right"><span class="version-badge">v0.1.135</span></div>
</header>
<nav class="sidebar"></nav>
<main class="main-content">

  <div class="breadcrumbs"><a href="index.html">Docs</a><span class="sep">/</span><a href="lib-overview.html">Standard Libraries</a><span class="sep">/</span>http</div>

  <h1>http</h1>
  <p class="page-subtitle">HTTP client and server for building web applications.</p>

  <h2>Setup</h2>
  <p>Add to your <code>project.toml</code>:</p>
  <pre><code>[libs]
http = { path = "../libs/http" }</code></pre>

  <pre><code><span class="kw">import</span> http.client
<span class="kw">import</span> http.server</code></pre>

  <h2>Making Requests</h2>

  <h4>get</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">get</span>(url: <span class="typ">String</span>) <span class="op">-&gt;</span> <span class="typ">Var</span>
  </div>
  <p>Performs an HTTP GET request to the given <code>url</code>. Returns a response handle that can be inspected with the response accessor functions. The handle must be freed with <code>response_free</code> when done.</p>

  <pre><code><span class="kw">import</span> http.client

<span class="kw">var</span> resp <span class="op">=</span> <span class="fn">get</span>(<span class="str">"https://api.example.com/status"</span>)

status <span class="op">=</span> <span class="fn">response_status</span>(resp)
<span class="fn">print</span>(<span class="str">"Status: "</span>)
<span class="fn">println</span>(status)   <span class="cmt">// 200</span>

body <span class="op">=</span> <span class="fn">response_body</span>(resp)
<span class="fn">println</span>(body)

<span class="fn">response_free</span>(resp)</code></pre>

  <h4>post</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">post</span>(url: <span class="typ">String</span>, body: <span class="typ">String</span>, content_type: <span class="typ">String</span>) <span class="op">-&gt;</span> <span class="typ">Var</span>
  </div>
  <p>Performs an HTTP POST request with the given <code>body</code> and <code>content_type</code> header. Returns a response handle.</p>

  <pre><code><span class="kw">import</span> http.client

payload <span class="op">=</span> <span class="str">"{\"username\": \"alice\", \"action\": \"login\"}"</span>
<span class="kw">var</span> resp <span class="op">=</span> <span class="fn">post</span>(<span class="str">"https://api.example.com/auth"</span>, payload, <span class="str">"application/json"</span>)

status <span class="op">=</span> <span class="fn">response_status</span>(resp)
<span class="fn">print</span>(<span class="str">"Status: "</span>)
<span class="fn">println</span>(status)

<span class="fn">response_free</span>(resp)</code></pre>

  <h2>Response Accessors</h2>

  <h4>response_status</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">response_status</span>(response: <span class="typ">Var</span>) <span class="op">-&gt;</span> <span class="typ">Int</span>
  </div>
  <p>Returns the HTTP status code of the response (e.g. <code>200</code>, <code>404</code>, <code>500</code>).</p>

  <h4>response_body</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">response_body</span>(response: <span class="typ">Var</span>) <span class="op">-&gt;</span> <span class="typ">String</span>
  </div>
  <p>Returns the response body as a string.</p>

  <h4>response_header</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">response_header</span>(response: <span class="typ">Var</span>, name: <span class="typ">String</span>) <span class="op">-&gt;</span> <span class="typ">String</span>
  </div>
  <p>Returns the value of the response header with the given <code>name</code>. Returns an empty string if the header is not present. Header names are case-insensitive.</p>

  <pre><code><span class="kw">import</span> http.client

<span class="kw">var</span> resp <span class="op">=</span> <span class="fn">get</span>(<span class="str">"https://api.example.com/data"</span>)

content_type <span class="op">=</span> <span class="fn">response_header</span>(resp, <span class="str">"Content-Type"</span>)
<span class="fn">print</span>(<span class="str">"Content-Type: "</span>)
<span class="fn">println</span>(content_type)   <span class="cmt">// application/json</span>

server <span class="op">=</span> <span class="fn">response_header</span>(resp, <span class="str">"Server"</span>)
<span class="fn">print</span>(<span class="str">"Server: "</span>)
<span class="fn">println</span>(server)

<span class="fn">response_free</span>(resp)</code></pre>

  <h2>Cleanup</h2>

  <h4>response_free</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">response_free</span>(response: <span class="typ">Var</span>) <span class="op">-&gt;</span> <span class="typ">Unit</span>
  </div>
  <p>Frees the response handle and releases associated resources. Always call this when you are done reading the response to avoid memory leaks.</p>

  <h2>HTTP Server</h2>

  <pre><code><span class="kw">import</span> http.server</code></pre>

  <h4>server.listen</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">listen</span>(port: <span class="typ">Int</span>) <span class="op">-&gt;</span> <span class="typ">Int</span>
  </div>
  <p>Creates an HTTP server listening on the given port. Returns a server handle.</p>

  <h4>server.accept</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">accept</span>(srv: <span class="typ">Int</span>) <span class="op">-&gt;</span> <span class="typ">Int</span>
  </div>
  <p>Blocks until an HTTP request arrives. Returns a connection handle with the parsed request.</p>

  <h4>server.method / path / header / body</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">method</span>(conn: <span class="typ">Int</span>) <span class="op">-&gt;</span> <span class="typ">String</span><br>
    <span class="kw">def</span> <span class="fn">path</span>(conn: <span class="typ">Int</span>) <span class="op">-&gt;</span> <span class="typ">String</span><br>
    <span class="kw">def</span> <span class="fn">header</span>(conn: <span class="typ">Int</span>, name: <span class="typ">String</span>) <span class="op">-&gt;</span> <span class="typ">String</span><br>
    <span class="kw">def</span> <span class="fn">body</span>(conn: <span class="typ">Int</span>) <span class="op">-&gt;</span> <span class="typ">String</span>
  </div>
  <p>Access the HTTP method, path, headers, and body of the incoming request.</p>

  <h4>server.respond</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">respond</span>(conn: <span class="typ">Int</span>, status: <span class="typ">Int</span>, body: <span class="typ">String</span>, content_type: <span class="typ">String</span>) <span class="op">-&gt;</span> <span class="typ">Unit</span>
  </div>
  <p>Sends an HTTP response with the given status code, body, and content type.</p>

  <h4>Convenience Response Methods</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">respond_json</span>(conn: <span class="typ">Int</span>, status: <span class="typ">Int</span>, json: <span class="typ">String</span>) <span class="op">-&gt;</span> <span class="typ">Unit</span><br>
    <span class="kw">def</span> <span class="fn">respond_text</span>(conn: <span class="typ">Int</span>, status: <span class="typ">Int</span>, text: <span class="typ">String</span>) <span class="op">-&gt;</span> <span class="typ">Unit</span><br>
    <span class="kw">def</span> <span class="fn">respond_html</span>(conn: <span class="typ">Int</span>, status: <span class="typ">Int</span>, html: <span class="typ">String</span>) <span class="op">-&gt;</span> <span class="typ">Unit</span>
  </div>
  <p>Shorthand for responding with JSON (<code>application/json</code>), plain text (<code>text/plain</code>), or HTML (<code>text/html</code>).</p>

  <h4>server.close_conn / close</h4>
  <div class="signature">
    <span class="kw">def</span> <span class="fn">close_conn</span>(conn: <span class="typ">Int</span>) <span class="op">-&gt;</span> <span class="typ">Unit</span><br>
    <span class="kw">def</span> <span class="fn">close</span>(srv: <span class="typ">Int</span>) <span class="op">-&gt;</span> <span class="typ">Unit</span>
  </div>
  <p>Close a connection or shut down the server.</p>

  <pre><code><span class="kw">import</span> http.server

srv <span class="op">=</span> <span class="fn">server.listen</span>(<span class="num">8080</span>)
<span class="fn">println</span>(<span class="str">"HTTP server on port 8080"</span>)

<span class="kw">while</span> (<span class="kw">true</span>) {
    conn <span class="op">=</span> <span class="fn">server.accept</span>(srv)
    m <span class="op">=</span> <span class="fn">server.method</span>(conn)
    p <span class="op">=</span> <span class="fn">server.path</span>(conn)
    <span class="fn">println</span>(m <span class="op">+</span> <span class="str">" "</span> <span class="op">+</span> p)

    <span class="fn">server.respond_json</span>(conn, <span class="num">200</span>, <span class="str">"{\"status\": \"ok\"}"</span>)
    <span class="fn">server.close_conn</span>(conn)
}</code></pre>

  <h2>Complete Example</h2>

  <pre><code><span class="kw">import</span> http.client
<span class="kw">import</span> std.json

<span class="cmt">// Fetch data from a REST API and parse the JSON response</span>
<span class="kw">def</span> <span class="fn">fetch_user</span>(user_id: <span class="typ">Int</span>) <span class="op">-&gt;</span> <span class="typ">Unit</span> {
    url <span class="op">=</span> <span class="str">"https://jsonplaceholder.typicode.com/users/"</span>
    <span class="cmt">// Note: string concatenation with int auto-converts</span>
    <span class="kw">var</span> resp <span class="op">=</span> <span class="fn">get</span>(url)

    status <span class="op">=</span> <span class="fn">response_status</span>(resp)
    <span class="kw">if</span> (status <span class="op">!=</span> <span class="num">200</span>) {
        <span class="fn">print</span>(<span class="str">"HTTP error: "</span>)
        <span class="fn">println</span>(status)
        <span class="fn">response_free</span>(resp)
        <span class="kw">return</span>
    }

    body <span class="op">=</span> <span class="fn">response_body</span>(resp)
    <span class="fn">response_free</span>(resp)

    <span class="cmt">// Parse JSON response</span>
    <span class="kw">var</span> user <span class="op">=</span> <span class="fn">json_parse</span>(body)
    name <span class="op">=</span> <span class="fn">json_get_string</span>(user, <span class="str">"name"</span>)
    email <span class="op">=</span> <span class="fn">json_get_string</span>(user, <span class="str">"email"</span>)

    <span class="fn">print</span>(<span class="str">"Name: "</span>)
    <span class="fn">println</span>(name)
    <span class="fn">print</span>(<span class="str">"Email: "</span>)
    <span class="fn">println</span>(email)
}

<span class="cmt">// POST JSON data to an API</span>
<span class="kw">def</span> <span class="fn">create_post</span>(title: <span class="typ">String</span>, content: <span class="typ">String</span>) <span class="op">-&gt;</span> <span class="typ">Bool</span> {
    payload <span class="op">=</span> <span class="str">"{\"title\": \""</span> <span class="op">+</span> title <span class="op">+</span> <span class="str">"\", \"body\": \""</span> <span class="op">+</span> content <span class="op">+</span> <span class="str">"\"}"</span>

    <span class="kw">var</span> resp <span class="op">=</span> <span class="fn">post</span>(
        <span class="str">"https://jsonplaceholder.typicode.com/posts"</span>,
        payload,
        <span class="str">"application/json"</span>
    )

    status <span class="op">=</span> <span class="fn">response_status</span>(resp)
    body <span class="op">=</span> <span class="fn">response_body</span>(resp)
    <span class="fn">response_free</span>(resp)

    <span class="fn">print</span>(<span class="str">"POST status: "</span>)
    <span class="fn">println</span>(status)
    <span class="fn">println</span>(body)

    <span class="kw">return</span> status <span class="op">==</span> <span class="num">201</span>
}

<span class="fn">fetch_user</span>(<span class="num">1</span>)
<span class="fn">create_post</span>(<span class="str">"Hello"</span>, <span class="str">"My first post from Nex!"</span>)</code></pre>

  <div class="page-nav">
    <a href="stdlib-crypto.html">
      <span class="nav-label">Previous</span>
      <span class="nav-title">&larr; crypto</span>
    </a>
    <a href="stdlib-regex.html">
      <span class="nav-label">Next</span>
      <span class="nav-title">regex &rarr;</span>
    </a>
  </div>

</main>
<script src="nav.js"></script>
<script src="script.js"></script>
</body>
</html>
